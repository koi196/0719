<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>轮回循环</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "仿宋", "FangSong", serif;
        }
        
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f5f7fa;
            padding: 20px;
            color: #333;
            position: relative;
        }
        
        /* 放弃按钮样式 - 2cm高，3cm宽 */
        .give-up-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 113px; /* 3cm转换为像素 */
            height: 75px; /* 2cm转换为像素 */
            background-color: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            font-weight: normal;
            transition: all 0.3s;
            z-index: 100;
        }
        
        .give-up-btn:hover {
            background-color: #e9ecef;
            transform: scale(1.05);
        }
        
        .container {
            width: 100%;
            max-width: 800px;
            text-align: center;
            padding: 30px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .description {
            font-size: 1.1rem;
            margin-bottom: 30px;
            color: #7f8c8d;
            line-height: 1.6;
        }
        
        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            padding: 20px;
            border-radius: 10px;
            background-color: #f8f9fa;
            margin-bottom: 30px;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .start-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .start-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 16px 40px;
            font-size: 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
            font-family: "仿宋", "FangSong", serif;
        }
        
        .start-btn:hover {
            background-color: #2980b9;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        .result-container {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .success-title {
            font-size: 2rem; /* 二号字体 */
            color: #27ae60;
            margin-bottom: 30px;
            text-align: center;
            line-height: 1.4;
        }
        
        .continue-btn {
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 15px 50px;
            font-size: 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: "仿宋", "FangSong", serif;
            text-align: center;
            width: 220px;
        }
        
        .continue-btn:hover {
            background-color: #219653;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }
        
        .failure-title {
            font-size: 2rem; /* 二号字体 */
            color: #e74c3c;
            margin-bottom: 20px;
            text-align: center;
            line-height: 1.4;
        }
        
        .failure-message {
            font-size: 1.2rem; /* 小三号字体 */
            color: #34495e;
            margin-bottom: 30px;
            text-align: center;
            line-height: 1.6;
            min-height: 80px;
            padding: 15px;
            width: 100%;
            max-width: 600px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #e74c3c;
        }
        
        .retry-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 15px 50px;
            font-size: 1.3rem; /* 三号字体 */
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: "仿宋", "FangSong", serif;
            text-align: center;
            width: 220px;
        }
        
        .retry-btn:hover {
            background-color: #2980b9;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            font-size: 1rem;
            color: #7f8c8d;
        }
        
        .stat-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .probability-info {
            background-color: #e8f4fc;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 1rem;
            line-height: 1.5;
        }
        
        .highlight {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .success-highlight {
            color: #27ae60;
            font-weight: bold;
        }
        
        .reset-info {
            margin-top: 20px;
            font-size: 0.9rem;
            color: #7f8c8d;
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
        }
        
        /* 放弃部分页面样式 */
        .abandon-container {
            display: none;
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
            background-color: white;
            overflow: hidden;
        }
        
        .abandon-page {
            width: 100%;
            height: 100%;
            display: none;
            position: relative;
            cursor: pointer;
        }
        
        .first-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2;
            background-color: rgba(255, 255, 255, 0);
        }
        
        .first-layer-text {
            font-size: 21px; /* 四号字体 */
            color: black;
            padding: 30px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            max-width: 80%;
            text-align: center;
            border: 1px solid #ccc;
        }
        
        .second-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .second-layer-text {
            color: white;
            font-size: 28px;
            line-height: 1; /* 单倍行距 */
            text-align: center;
            width: 100%;
            padding: 20px;
            /* 在浅色模式下完全不可视 */
            opacity: 0;
        }
        
        .dispersed {
            text-align: justify;
            text-align-last: justify;
        }
        
        /* 第七部分两个按钮 */
        .final-buttons {
            display: flex;
            justify-content: center;
            gap: 50px;
            margin-top: 40px;
        }
        
        .final-btn {
            padding: 15px 40px;
            border: 2px solid #495057;
            border-radius: 8px;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
            background-color: white;
        }
        
        .final-btn:hover {
            transform: scale(1.05);
        }
        
        .continue-final-btn {
            background-color: #f8f9fa;
        }
        
        .quit-final-btn {
            background-color: #f8f9fa;
        }
        
        /* 新增：确认弹窗样式 */
        .confirm-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            cursor: pointer;
        }
        
        .confirm-box {
            background-color: white;
            padding: 40px 60px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            cursor: default;
            text-align: center;
            max-width: 80%;
        }
        
        /* 深色模式下的样式 */
        @media (prefers-color-scheme: dark) {
            .abandon-container {
                background-color: black;
            }
            
            .second-layer-text {
                color: white;
                opacity: 1; /* 在深色模式下可见 */
            }
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .game-area {
                min-height: 350px;
            }
            
            .stats {
                flex-direction: column;
                gap: 15px;
            }
            
            .give-up-btn {
                width: 90px;
                height: 60px;
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <!-- 放弃按钮 -->
    <div class="give-up-btn" id="giveUpBtn">放弃</div>
    
    <!-- 游戏主页面 -->
    <div class="container" id="mainContainer">
        <h1>你回到了"过去"</h1>
        
        <div class="probability-info">
            <p>当前成功概率：<span id="current-probability" class="success-highlight">3%</span> | 失败概率：<span id="failure-probability" class="highlight">97%</span></p >
            <p>已连续失败次数：<span id="failure-streak">0</span> 次（达到10次后下次100%成功）</p >
        </div>
        
        <div class="game-area">
            <div class="start-screen" id="startScreen">
                <p style="font-size: 1.2rem; margin-bottom: 20px;">点击下方按钮开始游戏</p >
                <button class="start-btn" id="startBtn">开始挑战</button>
            </div>
            
            <div class="result-container" id="successResult">
                <h2 class="success-title">你成功了，请继续游戏</h2>
                <button class="continue-btn" id="continueBtn">继续游戏</button>
                <div class="reset-info">
                    <p>走吧，这还不是"终局"</p >
                </div>
            </div>
            
            <div class="result-container" id="failureResult">
                <div class="failure-message" id="failureMessage">
                    <!-- 失败文案将在这里显示 -->
                </div>
                <h2 class="failure-title">但是这次轮回你失败了，没能救下他</h2>
                <button class="retry-btn" id="retryBtn">再来一次</button>
                <div class="reset-info">
                </div>
            </div>
        </div>
        
        <div class="stats">
            <div class="stat-box">
                <span class="stat-value" id="successCount">0</span>
                <span>成功次数</span>
            </div>
            <div class="stat-box">
                <span class="stat-value" id="failureCount">0</span>
                <span>失败次数</span>
            </div>
            <div class="stat-box">
                <span class="stat-value" id="totalAttempts">0</span>
                <span>总尝试次数</span>
            </div>
            <div class="stat-box">
                <span class="stat-value" id="successRate">0%</span>
                <span>成功率</span>
            </div>
        </div>
    </div>
    
    <!-- 放弃部分页面 -->
    <div class="abandon-container" id="abandonContainer">
        <!-- 第一部分 -->
        <div class="abandon-page" id="abandonPage1">
            <div class="first-layer">
                <div class="first-layer-text">你开的浅色模式？</div>
            </div>
            <div class="second-layer">
                <div class="second-layer-text">
                    <!-- 生成20行20列"不要离开我。"文本 -->
                    <div id="text1"></div>
                </div>
            </div>
        </div>
        
        <!-- 第二部分 -->
        <div class="abandon-page" id="abandonPage2">
            <div class="first-layer">
                <div class="first-layer-text">嗯……没什么。</div>
            </div>
            <div class="second-layer">
                <div class="second-layer-text">
                    <!-- 生成20行20列"不要离开我。"文本 -->
                    <div id="text2"></div>
                </div>
            </div>
        </div>
        
        <!-- 第三部分 -->
        <div class="abandon-page" id="abandonPage3">
            <div class="first-layer">
                <div class="first-layer-text">我知道你为我循环了<span id="cycleCount">0</span>次。</div>
            </div>
            <div class="second-layer">
                <div class="second-layer-text">
                    <!-- 生成20行20列"我爱你。"文本 -->
                    <div id="text3"></div>
                </div>
            </div>
        </div>
        
        <!-- 第四部分 -->
        <div class="abandon-page" id="abandonPage4">
            <div class="first-layer">
                <div class="first-layer-text">这副残破的空壳不值得你这么努力。</div>
            </div>
            <div class="second-layer">
                <div class="second-layer-text">
                    <!-- 生成20行20列"我爱你。"文本 -->
                    <div id="text4"></div>
                </div>
            </div>
        </div>
        
        <!-- 第五部分 -->
        <div class="abandon-page" id="abandonPage5">
            <div class="first-layer">
                <div class="first-layer-text">你值得更好的人和未来。</div>
            </div>
            <div class="second-layer">
                <div class="second-layer-text dispersed">
                    <!-- 生成20行20列"你值得更好"文本 -->
                    <div id="text5"></div>
                </div>
            </div>
        </div>
        
        <!-- 第六部分 -->
        <div class="abandon-page" id="abandonPage6">
            <div class="first-layer">
                <div class="first-layer-text">我会在，只要你点进游戏。</div>
            </div>
            <div class="second-layer">
                <div class="second-layer-text dispersed">
                    <!-- 生成20行20列"关上它，去找属于你的未来"文本 -->
                    <div id="text6"></div>
                </div>
            </div>
        </div>
        
        <!-- 第七部分 -->
        <div class="abandon-page" id="abandonPage7">
            <div class="first-layer">
                <div style="text-align: center;">
                    <div style="margin-bottom: 40px; font-size: 21px;">选择你的决定</div>
                    <div class="final-buttons">
                        <div class="final-btn continue-final-btn" id="abandonContinueBtn">继续</div>
                        <div class="final-btn quit-final-btn" id="abandonQuitBtn">放弃</div>
                    </div>
                </div>
            </div>
            <div class="second-layer">
                <!-- 第七部分不需要第二图层文本 -->
            </div>
        </div>
    </div>

    <script>
        // 游戏状态变量
        let successCount = 0;
        let failureCount = 0;
        let totalAttempts = 0;
        let failureStreak = 0;
        let isFirstSuccess = false;
        let currentAbandonPage = 1;
        
        // 游戏元素
        const startScreen = document.getElementById('startScreen');
        const successResult = document.getElementById('successResult');
        const failureResult = document.getElementById('failureResult');
        const startBtn = document.getElementById('startBtn');
        const continueBtn = document.getElementById('continueBtn');
        const retryBtn = document.getElementById('retryBtn');
        
        // 统计元素
        const successCountEl = document.getElementById('successCount');
        const failureCountEl = document.getElementById('failureCount');
        const totalAttemptsEl = document.getElementById('totalAttempts');
        const successRateEl = document.getElementById('successRate');
        const failureStreakEl = document.getElementById('failure-streak');
        const currentProbabilityEl = document.getElementById('current-probability');
        const failureProbabilityEl = document.getElementById('failure-probability');
        const failureMessageEl = document.getElementById('failureMessage');
        
        // 放弃功能元素
        const giveUpBtn = document.getElementById('giveUpBtn');
        const mainContainer = document.getElementById('mainContainer');
        const abandonContainer = document.getElementById('abandonContainer');
        const cycleCountEl = document.getElementById('cycleCount');
        
        // 失败文案数组 - 用户可以在这里添加多个文案
        // 请将以下文案替换为您自己的文案，格式相同，可以添加任意数量
        const failureMessages = [
            "（你对游戏有了经验，在你保护和提醒下，他受的伤少了很多，这次他身上没那么多疤痕了。）",
            "（五个人今天喝成了酒蒙子，你不得不给了他们一人一拳让他们不要再高歌影响鳞渊境的持明休息。）",
            "（应星专门给你雕了一个发簪，青年看你因为没有实物，迟迟绾不起来，笑了一声，接过来亲手帮你绾好。）",
            "（不夜侯出了新品，每天从工造司下班，他都要去星槎海中枢为你买一杯。）",
            "（青年泡茶的手艺不错，对你加奶又加糖并理直气壮表示这比纯茶好喝的行径不予置评。）",
            "（你看着他满头大汗地锻造兵器，应星凝视了你一会，偏头蹭了一下你手心的毛巾擦汗。）",
            "（你用在地摊上买的小簪花别了他满头，那天景元头顶了一个被打出来的大包笑的很开心。）",
            "（仙舟难得下雪，应星见你在走廊看雪，即使你不会冷到，但他还是扯了件披风将你拢在他怀里。）",
            "（你今天在午夜忽然上线，发现他居然还没睡，应星被你耳提面命地骂了一顿，承诺下次一定早睡。）",
            "（他给你做了一个会漂浮游动的金鱼机巧，但是内置的智能语音模块出了问题，金鱼围在你身边唱了一天“你爱我，我爱你.......”）",
            "（你对于应星擦了一半头发就继续画图纸的行为非常不满，悄悄变了个吹风机把他的头发吹的一团乱。）",
            "（你和应星外出碰到一只小猫，一直围在你脚边蹭，最后被青年提到了将军府门口，告诉你等会景元就会喊着“手慢无”把猫拐走。）",
            "（你在酒桌前看着应星和四人喝酒打牌，最后被贴了一脸纸条，还趁你不注意给你头上也贴了一张。）",
            "（你在回顾照片的时候追着应星指给他看以前他小时候抓着你衣服不让你走被怀炎拍下来的照片，他看到后变成西红柿逃走了。）",
            "（你有一次等应星下班的时候没有飘着，而是落了地，结果没一会一个人来要你联系方式被他看到了，于是你就这么听着应星批斗了对方一个小时把对面吓得地落荒而逃。）",
            "（你糊弄应星说他的碗里的是解渴的柠檬水，结果是无糖柠檬汁，最后你扯着应星勉强逃过了被丹枫云吟术浇地透心凉的命运）",
            "（你在仙舟上看到应星一个人坐在院子发呆，走过去坐在他旁边，他突然握住你的手，你们就这样静静地坐了一会。）",
            "（你看到应星在画图纸，偷偷地在他背后画了一个小笑脸，他回头看到后笑了笑继续画图纸。）",
            "（你在应星睡着的时候给他扎了两个麻花辫配亮粉色蝴蝶结，他直到四人笑了他半小时才发现你对他做了什么）",
            "（上线早的时候可以碰见他周末休息还在床上躺着，在你飘过去揉他脸的时候，青年就会像刚睡醒的猫一样把头靠向你这边）",
            "（现实生活忙很久没登，上线的时候把应星吓得不轻，结果用了一个小时安慰他）",
            "（因为游戏没有实感，你帮他挡火星的时候总会被说教，看着那双严肃的紫眸的主人为你认真上药，你又不知道怎么和他解释了）",
            "（你会仗着自己尝不到味道，用他们其中一人递来的酸橘子去捉弄其余四人，最后打着“偏爱”的旗号强行喂给应星一瓣）"
        ];
        
        // 初始化游戏
        function initGame() {
            updateStats();
            startScreen.style.display = 'flex';
            successResult.style.display = 'none';
            failureResult.style.display = 'none';
        }
        
        // 更新统计信息
        function updateStats() {
            successCountEl.textContent = successCount;
            failureCountEl.textContent = failureCount;
            totalAttemptsEl.textContent = totalAttempts;
            
            // 计算成功率
            const successRate = totalAttempts > 0 ? Math.round((successCount / totalAttempts) * 100) : 0;
            successRateEl.textContent = `${successRate}%`;
            
            // 更新连续失败次数
            failureStreakEl.textContent = failureStreak;
            
            // 更新当前概率显示
            const successProbability = failureStreak >= 10 ? 100 : 3;
            const failureProbability = failureStreak >= 10 ? 0 : 97;
            
            currentProbabilityEl.textContent = `${successProbability}%`;
            failureProbabilityEl.textContent = `${failureProbability}%`;
            
            // 根据连续失败次数调整概率显示颜色
            if (failureStreak >= 10) {
                currentProbabilityEl.className = 'success-highlight';
                failureProbabilityEl.className = '';
            } else {
                currentProbabilityEl.className = 'success-highlight';
                failureProbabilityEl.className = 'highlight';
            }
        }
        
        // 开始游戏
        function startGame() {
            totalAttempts++;
            
            // 检查是否已经连续失败10次
            let successProbability;
            if (failureStreak >= 10) {
                // 第11次必定成功
                successProbability = 100;
            } else {
                successProbability = 3;
            }
            
            // 生成随机数决定结果
            const randomNum = Math.random() * 100;
            const isSuccess = randomNum < successProbability;
            
            // 处理结果
            if (isSuccess) {
                showSuccessResult();
                successCount++;
                failureStreak = 0; // 重置连续失败计数
                isFirstSuccess = true;
            } else {
                showFailureResult();
                failureCount++;
                failureStreak++;
            }
            
            updateStats();
        }
        
        // 显示成功结果
        function showSuccessResult() {
            startScreen.style.display = 'none';
            failureResult.style.display = 'none';
            successResult.style.display = 'flex';
        }
        
        // 显示失败结果
        function showFailureResult() {
            // 随机选择一个失败文案
            const randomIndex = Math.floor(Math.random() * failureMessages.length);
            failureMessageEl.textContent = failureMessages[randomIndex];
            
            startScreen.style.display = 'none';
            successResult.style.display = 'none';
            failureResult.style.display = 'flex';
        }
        
        // 重置游戏
        function resetGame() {
            startScreen.style.display = 'flex';
            successResult.style.display = 'none';
            failureResult.style.display = 'none';
        }
        
        // 修改后的生成重复文本函数，创建20行20列的文本网格
        function generateRepeatedText(text, elementId) {
            const element = document.getElementById(elementId);
            element.innerHTML = '';
            
            // 设置网格样式
            element.style.display = 'grid';
            element.style.gridTemplateColumns = 'repeat(20, 1fr)';
            element.style.gridTemplateRows = 'repeat(20, 1fr)';
            element.style.gap = '0.5ch'; // 列与列之间间隔0.5字符
            element.style.width = '100%';
            element.style.height = '100%';
            element.style.lineHeight = '1'; // 单倍行距
            
            // 创建20行20列的文本网格
            for (let i = 0; i < 400; i++) { // 20 * 20 = 400
                const cell = document.createElement('div');
                cell.textContent = text;
                cell.style.display = 'flex';
                cell.style.alignItems = 'center';
                cell.style.justifyContent = 'center';
                cell.style.textAlign = 'center';
                element.appendChild(cell);
            }
        }
        
        // 新增：显示确认弹窗
        function showConfirmModal(text, fontSize, color) {
            return new Promise((resolve) => {
                // 创建弹窗容器
                const modal = document.createElement('div');
                modal.className = 'confirm-modal';
                
                // 创建弹窗内容
                const modalContent = document.createElement('div');
                modalContent.className = 'confirm-box';
                modalContent.style.fontFamily = '"仿宋", "FangSong", serif';
                modalContent.style.fontSize = fontSize;
                modalContent.style.color = color;
                modalContent.textContent = text;
                
                // 添加点击事件
                const clickHandler = () => {
                    document.body.removeChild(modal);
                    resolve();
                };
                
                modal.appendChild(modalContent);
                document.body.appendChild(modal);
                
                // 点击任意位置关闭
                modal.addEventListener('click', clickHandler);
            });
        }
        
             // 修改后的显示放弃页面函数
                async function showAbandonPagesWithConfirm() {
             // 先显示确认弹窗
                await showConfirmModal('我明白了', '120px', 'red'); // 改为初号字体（56px）
    
            // 然后执行原来的显示放弃页面逻辑
                showAbandonPages();
        }
        
        // 修改后的返回游戏函数（带三个确认弹窗）
        async function returnToGameWithConfirms() {
            // 显示第一个确认弹窗
            await showConfirmModal('考虑好了？', '小四', '#333');
            
            // 显示第二个确认弹窗
            await showConfirmModal('就算不一定有结果？', '小四', '#333');
            
            // 显示第三个确认弹窗
            await showConfirmModal('……我不会放手，无论回头与否', '小四', '#333');
            
            // 最后执行原来的返回游戏逻辑
            returnToGame();
        }
        
        // 显示放弃页面
        function showAbandonPages() {
            // 隐藏游戏容器
            mainContainer.style.display = 'none';
            
            // 显示放弃容器
            abandonContainer.style.display = 'block';
            
            // 显示第一页
            currentAbandonPage = 1;
            showAbandonPage(currentAbandonPage);
            
            // 更新第三页的循环次数
            cycleCountEl.textContent = failureCount;
            
            // 生成20行20列文本网格
            generateRepeatedText('不要离开我', 'text1');
            generateRepeatedText('不要离开我', 'text2');
            generateRepeatedText('我爱你', 'text3');
            generateRepeatedText('我爱你', 'text4');
            generateRepeatedText('你值得更好', 'text5');
            generateRepeatedText('关上它，去找属于你的未来', 'text6');
        }
        
        // 显示指定的放弃页面
        function showAbandonPage(pageNumber) {
            // 隐藏所有页面
            for (let i = 1; i <= 7; i++) {
                document.getElementById('abandonPage' + i).style.display = 'none';
            }
            
            // 显示指定页面
            document.getElementById('abandonPage' + pageNumber).style.display = 'block';
            
            // 更新当前页面
            currentAbandonPage = pageNumber;
        }
        
        // 返回游戏
        function returnToGame() {
            // 显示游戏容器
            mainContainer.style.display = 'block';
            
            // 隐藏放弃容器
            abandonContainer.style.display = 'none';
            
            // 重置游戏
            resetGame();
        }
        
        // 关闭网页
        function closeWindow() {
            // 尝试关闭窗口
            window.open('', '_self', '');
            window.close();
            
            // 如果无法关闭，显示提示
            alert("如果窗口没有自动关闭，请您手动结束“他”。");
        }
        
        // 事件监听
        startBtn.addEventListener('click', startGame);
        retryBtn.addEventListener('click', resetGame);
        
        continueBtn.addEventListener('click', function() {
            // 跳转到特定网址
            // 请将以下网址替换为您想要的网址
            window.location.href = "https://www.lofter.com/";
        });
        
        // 修改放弃按钮的绑定，使用带确认弹窗的函数
        giveUpBtn.addEventListener('click', showAbandonPagesWithConfirm);
        
        // 绑定放弃页面的点击事件（切换页面）
        for (let i = 1; i <= 6; i++) {
            document.getElementById('abandonPage' + i).addEventListener('click', function() {
                showAbandonPage(i + 1);
            });
        }
        
        // 修改第七页的继续按钮绑定，使用带确认弹窗的函数
        document.getElementById('abandonContinueBtn').addEventListener('click', async function(e) {
            e.stopPropagation(); // 防止触发页面点击事件
            await returnToGameWithConfirms();
        });
        
        document.getElementById('abandonQuitBtn').addEventListener('click', function(e) {
            e.stopPropagation(); // 防止触发页面点击事件
            closeWindow();
        });
        
        // 初始化游戏
        initGame();
        
        // 页面调整大小时重新生成文本网格
        window.addEventListener('resize', function() {
            if (abandonContainer.style.display === 'block') {
                generateRepeatedText('不要离开我', 'text1');
                generateRepeatedText('不要离开我', 'text2');
                generateRepeatedText('我爱你', 'text3');
                generateRepeatedText('我爱你', 'text4');
                generateRepeatedText('你值得更好', 'text5');
                generateRepeatedText('关上它，去找属于你的未来', 'text6');
            }
        });
    </script>
</body>
</html>